<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 2: Understanding Tax Brackets - Budgex</title>
    <link rel="stylesheet" href="lesson.css">
</head>
<body>
    <script src="../../Dashboard/api-client.js"></script>
    <script>
        // Check authentication on page load
        if (!api.isAuthenticated()) {
            window.location.href = '../../Public/Auth/signin.html';
        }
    </script>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">Budgex</div>

        <nav class="sidebar-nav">
            <a href="../../Dashboard/dashboard-interactive.html" class="nav-item">
                <span class="nav-icon icon-home"></span>
                <span>Dashboard</span>
            </a>
            <a href="../mycourses.html" class="nav-item active">
                <span class="nav-icon icon-courses"></span>
                <span>My Courses</span>
            </a>
            <a href="../../Tools/tools.html" class="nav-item">
                <span class="nav-icon icon-tools"></span>
                <span>Tools</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar">JD</div>
                <div class="user-info">
                    <div class="user-name" id="user-name">John Doe</div>
                    <div class="user-email" id="user-email">john@example.com</div>
                </div>
            </div>
            <a href="#" class="nav-item" id="logout-btn">
                <span class="nav-icon icon-logout"></span>
                <span>Logout</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Lesson Header -->
        <header class="lesson-header">
            <div class="breadcrumb">
                <a href="../mycourses.html">My Courses</a>
                <span class="separator">/</span>
                <a href="../unit.html?course=tax-fundamentals">Tax Fundamentals</a>
                <span class="separator">/</span>
                <span class="current">Lesson 2</span>
            </div>
            <h1 class="lesson-title">Understanding Tax Brackets</h1>
            <div class="lesson-meta">
                <span class="lesson-duration">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="8" cy="8" r="7" stroke="#fbbf24" stroke-width="2" fill="none"/>
                        <path d="M8 4 L8 8 L11 8" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    50 minutes
                </span>
                <span class="lesson-progress-indicator">
                    <span id="current-section">1</span> / <span id="total-sections">5</span>
                </span>
            </div>
        </header>

        <!-- Progress Bar -->
        <div class="lesson-progress-bar">
            <div class="lesson-progress-fill" id="lesson-progress-fill" style="width: 0%"></div>
        </div>

        <!-- Lesson Content Container -->
        <div class="lesson-container">
            <!-- Section 1: What Are Tax Brackets? -->
            <section class="lesson-section active" id="section-1">
                <div class="section-number">Section 1 of 5</div>
                <h2 class="section-title">What Are Tax Brackets?</h2>

                <div class="content-block">
                    <p class="content-text">
                        <strong>Tax brackets are income ranges</strong> that determine what percentage of your income you pay in taxes. The United States uses a progressive tax system, which means different portions of your income are taxed at different rates.
                    </p>
                    <p class="content-text">
                        Here's the key misconception: Many people think that if they move into a higher tax bracket, ALL of their income is taxed at that higher rate. This is <strong>not true</strong>.
                    </p>
                </div>

                <div class="info-box">
                    <div class="info-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="#fbbf24" stroke-width="2"/>
                            <path d="M12 8 L12 12 L12 16" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="12" cy="6" r="1" fill="#fbbf24"/>
                        </svg>
                    </div>
                    <div class="info-content">
                        <h3 class="info-title">Important Concept</h3>
                        <p>Only the income that falls within each bracket is taxed at that bracket's rate. This is called a <strong>progressive tax system</strong>.</p>
                    </div>
                </div>

                <div class="visual-card">
                    <h3 class="visual-title">2024 Federal Tax Brackets (Single Filer)</h3>
                    <div class="tax-breakdown-chart">
                        <div class="chart-bar-container">
                            <div class="chart-label">$0 - $11,000</div>
                            <div class="chart-bar-wrapper">
                                <div class="chart-bar" style="width: 10%; background: #2ed573;">
                                    <span class="chart-value">10%</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-bar-container">
                            <div class="chart-label">$11,001 - $44,725</div>
                            <div class="chart-bar-wrapper">
                                <div class="chart-bar" style="width: 12%; background: #fbbf24;">
                                    <span class="chart-value">12%</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-bar-container">
                            <div class="chart-label">$44,726 - $95,375</div>
                            <div class="chart-bar-wrapper">
                                <div class="chart-bar" style="width: 22%; background: #f59e0b;">
                                    <span class="chart-value">22%</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-bar-container">
                            <div class="chart-label">$95,376 - $182,100</div>
                            <div class="chart-bar-wrapper">
                                <div class="chart-bar" style="width: 24%; background: #d97706;">
                                    <span class="chart-value">24%</span>
                                </div>
                            </div>
                        </div>
                        <div class="chart-bar-container">
                            <div class="chart-label">$182,101+</div>
                            <div class="chart-bar-wrapper">
                                <div class="chart-bar" style="width: 32%; background: #e74c3c;">
                                    <span class="chart-value">32%+</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-secondary" disabled>Previous</button>
                    <button class="btn-primary next-btn" onclick="goToSection(2)">Next Section</button>
                </div>
            </section>

            <!-- Section 2: Marginal vs Effective Tax Rate -->
            <section class="lesson-section" id="section-2">
                <div class="section-number">Section 2 of 5</div>
                <h2 class="section-title">Marginal vs. Effective Tax Rate</h2>

                <div class="content-block">
                    <p class="content-text">
                        There are two critical tax rate concepts you need to understand:
                    </p>
                </div>

                <div class="impact-cards">
                    <div class="impact-card">
                        <div class="impact-number">1</div>
                        <h3 class="impact-title">Marginal Tax Rate</h3>
                        <p class="impact-description">
                            This is the tax rate you pay on your <strong>last dollar</strong> of income. It's the highest tax bracket your income reaches.
                        </p>
                        <div class="example-box">
                            <strong>Example:</strong><br>
                            If you earn $50,000, your marginal rate is 22% because your income reaches into the 22% bracket.
                        </div>
                    </div>

                    <div class="impact-card">
                        <div class="impact-number">2</div>
                        <h3 class="impact-title">Effective Tax Rate</h3>
                        <p class="impact-description">
                            This is the <strong>average percentage</strong> of your total income that you actually pay in taxes. It's always lower than your marginal rate.
                        </p>
                        <div class="example-box">
                            <strong>Example:</strong><br>
                            Even though your marginal rate might be 22%, your effective rate could be only 13% because of lower rates on earlier dollars.
                        </div>
                    </div>
                </div>

                <div class="highlight-box">
                    <h3>Why This Matters:</h3>
                    <ul class="services-list">
                        <li><span class="check-icon">âœ“</span> Your effective rate shows your true tax burden</li>
                        <li><span class="check-icon">âœ“</span> Making more money never leaves you worse off</li>
                        <li><span class="check-icon">âœ“</span> Only the extra income is taxed at the higher rate</li>
                        <li><span class="check-icon">âœ“</span> Helps you understand raise and bonus impacts</li>
                    </ul>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-secondary prev-btn" onclick="goToSection(1)">Previous</button>
                    <button class="btn-primary next-btn" onclick="goToSection(3)">Next Section</button>
                </div>
            </section>

            <!-- Section 3: How Tax Brackets Work (Example) -->
            <section class="lesson-section" id="section-3">
                <div class="section-number">Section 3 of 5</div>
                <h2 class="section-title">Real-World Example: $60,000 Income</h2>

                <div class="content-block">
                    <p class="content-text">
                        Let's walk through a concrete example to see how tax brackets work in practice. Imagine you're a single filer earning <strong>$60,000</strong> per year.
                    </p>
                </div>

                <div class="visual-card">
                    <h3 class="visual-title">Tax Calculation Breakdown</h3>
                    <div class="comparison-chart">
                        <div class="comparison-item">
                            <div class="comparison-label">First $11,000 taxed at 10%</div>
                            <div class="comparison-bar" style="background: #2ed573; width: 30%;">
                                <span class="comparison-value">$1,100</span>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">Next $33,725 taxed at 12%</div>
                            <div class="comparison-bar" style="background: #fbbf24; width: 60%;">
                                <span class="comparison-value">$4,047</span>
                            </div>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label">Remaining $15,275 taxed at 22%</div>
                            <div class="comparison-bar" style="background: #f59e0b; width: 50%;">
                                <span class="comparison-value">$3,361</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="summary-card">
                    <h3>ðŸ“Š Final Tax Calculation</h3>
                    <ul class="summary-list">
                        <li>Total Income: <strong>$60,000</strong></li>
                        <li>Total Tax Owed: <strong>$8,508</strong></li>
                        <li>Marginal Tax Rate: <strong>22%</strong></li>
                        <li>Effective Tax Rate: <strong>14.2%</strong> ($8,508 Ã· $60,000)</li>
                        <li>Take-Home Pay: <strong>$51,492</strong></li>
                    </ul>
                </div>

                <div class="info-box">
                    <div class="info-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="#fbbf24" stroke-width="2"/>
                            <path d="M12 8 L12 12 L12 16" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="12" cy="6" r="1" fill="#fbbf24"/>
                        </svg>
                    </div>
                    <div class="info-content">
                        <h3 class="info-title">Key Takeaway</h3>
                        <p>Even though you're in the 22% tax bracket, you only pay 14.2% of your total income in federal taxes. This is the power of progressive taxation!</p>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-secondary prev-btn" onclick="goToSection(2)">Previous</button>
                    <button class="btn-primary next-btn" onclick="goToSection(4)">Next Section</button>
                </div>
            </section>

            <!-- Section 4: Knowledge Check Quiz -->
            <section class="lesson-section" id="section-4">
                <div class="section-number">Section 4 of 5</div>
                <h2 class="section-title">Knowledge Check</h2>

                <div class="content-block">
                    <p class="content-text">
                        Test your understanding of tax brackets and rates with these questions.
                    </p>
                </div>

                <div class="quiz-container">
                    <!-- Question 1 -->
                    <div class="quiz-question" id="quiz-1">
                        <div class="question-header">
                            <span class="question-number">Question 1 of 3</span>
                        </div>
                        <h3 class="question-text">If you move into a higher tax bracket, what happens to your income?</h3>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(1, 'A', false)">
                                <input type="radio" name="q1" id="q1-a">
                                <label for="q1-a">A) All of your income is taxed at the higher rate</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(1, 'B', true)">
                                <input type="radio" name="q1" id="q1-b">
                                <label for="q1-b">B) Only the income above the bracket threshold is taxed at the higher rate</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(1, 'C', false)">
                                <input type="radio" name="q1" id="q1-c">
                                <label for="q1-c">C) You pay less in taxes overall</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(1, 'D', false)">
                                <input type="radio" name="q1" id="q1-d">
                                <label for="q1-d">D) Your employer automatically withholds more money</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback-1"></div>
                    </div>

                    <!-- Question 2 -->
                    <div class="quiz-question" id="quiz-2" style="display: none;">
                        <div class="question-header">
                            <span class="question-number">Question 2 of 3</span>
                        </div>
                        <h3 class="question-text">What is the effective tax rate?</h3>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(2, 'A', false)">
                                <input type="radio" name="q2" id="q2-a">
                                <label for="q2-a">A) The highest tax bracket you reach</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(2, 'B', true)">
                                <input type="radio" name="q2" id="q2-b">
                                <label for="q2-b">B) The average percentage of your total income paid in taxes</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(2, 'C', false)">
                                <input type="radio" name="q2" id="q2-c">
                                <label for="q2-c">C) The tax rate on your last dollar earned</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(2, 'D', false)">
                                <input type="radio" name="q2" id="q2-d">
                                <label for="q2-d">D) Always the same as the marginal rate</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback-2"></div>
                    </div>

                    <!-- Question 3 -->
                    <div class="quiz-question" id="quiz-3" style="display: none;">
                        <div class="question-header">
                            <span class="question-number">Question 3 of 3</span>
                        </div>
                        <h3 class="question-text">True or False: Getting a raise can never leave you with less money after taxes.</h3>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(3, 'A', true)">
                                <input type="radio" name="q3" id="q3-a">
                                <label for="q3-a">A) True - You always take home more</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(3, 'B', false)">
                                <input type="radio" name="q3" id="q3-b">
                                <label for="q3-b">B) False - A raise can reduce your take-home pay</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback-3"></div>
                    </div>

                    <div class="quiz-results" id="quiz-results" style="display: none;">
                        <h3>Quiz Complete! ðŸŽ‰</h3>
                        <p class="quiz-score">You got <span id="quiz-score">0</span> out of 3 correct!</p>
                        <p class="quiz-message" id="quiz-message"></p>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-secondary prev-btn" onclick="goToSection(3)">Previous</button>
                    <button class="btn-primary next-btn" id="quiz-next-btn" onclick="goToSection(5)" disabled>Next Section</button>
                </div>
            </section>

            <!-- Section 5: Summary & Next Steps -->
            <section class="lesson-section" id="section-5">
                <div class="section-number">Section 5 of 5</div>
                <h2 class="section-title">Lesson Summary</h2>

                <div class="summary-card">
                    <h3>ðŸŽ¯ What You Learned Today</h3>
                    <ul class="summary-list">
                        <li><strong>Tax brackets are income ranges</strong> that determine the tax rate on portions of your income</li>
                        <li><strong>Progressive taxation</strong> means only the income in each bracket is taxed at that rate</li>
                        <li><strong>Marginal rate</strong> is the rate on your last dollar earned</li>
                        <li><strong>Effective rate</strong> is your average tax rate and is always lower than marginal</li>
                        <li><strong>Higher income never hurts you</strong> because only the extra is taxed at higher rates</li>
                    </ul>
                </div>

                <div class="next-lesson-preview">
                    <h3>ðŸ“š Coming Up Next: Types of Income</h3>
                    <p>In the next lesson, you'll learn about different types of income (earned, passive, capital gains) and how they're taxed differently.</p>
                    <div class="preview-topics">
                        <span class="preview-tag">Earned Income</span>
                        <span class="preview-tag">Passive Income</span>
                        <span class="preview-tag">Capital Gains</span>
                    </div>
                </div>

                <div class="completion-actions">
                    <button class="btn-secondary prev-btn" onclick="goToSection(4)">Previous</button>
                    <button class="btn-primary complete-btn" onclick="completeLesson()">Complete Lesson</button>
                </div>
            </section>
        </div>
    </main>

    <script>
        let currentSection = 1;
        let quizScore = 0;
        let quizAnswered = [false, false, false];
        let currentQuizQuestion = 1;

        // Update progress bar
        function updateProgress() {
            const progress = (currentSection / 5) * 100;
            document.getElementById('lesson-progress-fill').style.width = progress + '%';
            document.getElementById('current-section').textContent = currentSection;
        }

        // Navigate between sections
        function goToSection(sectionNum) {
            // Hide current section
            document.getElementById(`section-${currentSection}`).classList.remove('active');

            // Show new section
            currentSection = sectionNum;
            document.getElementById(`section-${currentSection}`).classList.add('active');

            // Update progress
            updateProgress();

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Quiz functionality
        function selectAnswer(questionNum, answer, isCorrect) {
            const feedback = document.getElementById(`feedback-${questionNum}`);
            const option = event.currentTarget;

            // Disable all options for this question
            const allOptions = option.parentElement.querySelectorAll('.quiz-option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.classList.add('disabled');
            });

            // Mark selected option
            option.classList.add(isCorrect ? 'correct' : 'incorrect');

            if (isCorrect) {
                if (!quizAnswered[questionNum - 1]) {
                    quizScore++;
                    quizAnswered[questionNum - 1] = true;
                }
                feedback.innerHTML = `
                    <div class="feedback-correct">
                        <span class="feedback-icon">âœ“</span>
                        <span>Correct! Great job!</span>
                    </div>
                `;
            } else {
                quizAnswered[questionNum - 1] = true;
                feedback.innerHTML = `
                    <div class="feedback-incorrect">
                        <span class="feedback-icon">âœ—</span>
                        <span>Not quite. Review the material and try again!</span>
                    </div>
                `;
            }

            feedback.style.display = 'block';

            // Show next question or results
            setTimeout(() => {
                if (questionNum < 3) {
                    document.getElementById(`quiz-${questionNum}`).style.display = 'none';
                    document.getElementById(`quiz-${questionNum + 1}`).style.display = 'block';
                    currentQuizQuestion++;
                } else {
                    // Show results
                    showQuizResults();
                }
            }, 1500);
        }

        function showQuizResults() {
            document.getElementById('quiz-3').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'block';
            document.getElementById('quiz-score').textContent = quizScore;

            const messageEl = document.getElementById('quiz-message');
            if (quizScore === 3) {
                messageEl.innerHTML = 'ðŸŒŸ Perfect score! You have mastered tax brackets!';
            } else if (quizScore === 2) {
                messageEl.innerHTML = 'ðŸ‘ Good job! You understand the key concepts.';
            } else {
                messageEl.innerHTML = 'ðŸ“– Keep learning! Review the material and you\'ll get it.';
            }

            // Enable next button
            document.getElementById('quiz-next-btn').disabled = false;
        }

        // Complete lesson
        async function completeLesson() {
            const btn = document.querySelector('.complete-btn');
            btn.disabled = true;
            btn.textContent = 'Saving...';
            
            try {
                // Calculate score percentage (out of 3 questions)
                const scorePercentage = Math.round((quizScore / 3) * 100);
                
                console.log('Saving lesson completion:', {
                    courseId: 'tax-fundamentals',
                    lessonId: 2,
                    score: scorePercentage,
                    duration: 50
                });
                
                // Save completion to backend - this will automatically unlock Lesson 3
                const result = await api.completeLesson('tax-fundamentals', 2, scorePercentage, 50);
                
                console.log('Lesson completion result:', result);

                // Notify user
                alert('ðŸŽ‰ Congratulations! You\'ve completed Lesson 2 and unlocked Lesson 3!');

                // Redirect back to course page
                window.location.href = '../unit.html';
            } catch (error) {
                console.error('Error completing lesson:', error);
                alert('Error saving progress: ' + error.message + '\n\nReturning to course page.');
                // Still redirect even if save fails
                window.location.href = '../unit.html';
            }
        }

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', (e) => {
            e.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                api.logout();
            }
        });

        // Initialize
        updateProgress();
    </script>
</body>
</html>
