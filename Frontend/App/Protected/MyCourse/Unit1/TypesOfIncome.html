<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 3: Types of Income - Budgex</title>
    <link rel="stylesheet" href="lesson.css">
</head>
<body>
    <script src="../Dashboard/api-client.js"></script>
    <script>
        // Check authentication on page load
        if (!api.isAuthenticated()) {
            window.location.href = '../../Public/Auth/signin.html';
        }
    </script>

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">Budgex</div>

        <nav class="sidebar-nav">
            <a href="../../Protected/Dashboard/dashboard-interactive.html" class="nav-item">
                <span class="nav-icon icon-home"></span>
                <span>Dashboard</span>
            </a>
            <a href="mycourses.html" class="nav-item active">
                <span class="nav-icon icon-courses"></span>
                <span>My Courses</span>
            </a>
            <a href="../Tools/tools.html" class="nav-item">
                <span class="nav-icon icon-tools"></span>
                <span>Tools</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar">JD</div>
                <div class="user-info">
                    <div class="user-name" id="user-name">John Doe</div>
                    <div class="user-email" id="user-email">john@example.com</div>
                </div>
            </div>
            <a href="#" class="nav-item" id="logout-btn">
                <span class="nav-icon icon-logout"></span>
                <span>Logout</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Lesson Header -->
        <header class="lesson-header">
            <div class="breadcrumb">
                <a href="mycourses.html">My Courses</a>
                <span class="separator">/</span>
                <a href="unit.html?course=tax-fundamentals">Tax Fundamentals</a>
                <span class="separator">/</span>
                <span class="current">Lesson 3</span>
            </div>
            <h1 class="lesson-title">Types of Income</h1>
            <div class="lesson-meta">
                <span class="lesson-duration">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="8" cy="8" r="7" stroke="#fbbf24" stroke-width="2" fill="none"/>
                        <path d="M8 4 L8 8 L11 8" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    55 minutes
                </span>
                <span class="lesson-progress-indicator">
                    <span id="current-section">1</span> / <span id="total-sections">5</span>
                </span>
            </div>
        </header>

        <!-- Progress Bar -->
        <div class="lesson-progress-bar">
            <div class="lesson-progress-fill" id="lesson-progress-fill" style="width: 0%"></div>
        </div>

        <!-- Lesson Content Container -->
        <div class="lesson-container">
            <!-- Section 1: Earned Income -->
            <section class="lesson-section active" id="section-1">
                <div class="section-number">Section 1 of 5</div>
                <h2 class="section-title">Earned Income (Active Income)</h2>

                <div class="content-block">
                    <p class="content-text">
                        <strong>Earned income</strong> is money you receive from working. This is the most common type of income and is taxed at ordinary income tax rates (the tax brackets we learned about in Lesson 2).
                    </p>
                </div>

                <div class="highlight-box">
                    <h3>Examples of Earned Income:</h3>
                    <ul class="services-list">
                        <li><span class="check-icon">âœ“</span> Salaries and wages from your job</li>
                        <li><span class="check-icon">âœ“</span> Tips and bonuses</li>
                        <li><span class="check-icon">âœ“</span> Self-employment income</li>
                        <li><span class="check-icon">âœ“</span> Freelance and gig work</li>
                        <li><span class="check-icon">âœ“</span> Commissions</li>
                    </ul>
                </div>

                <div class="visual-card">
                    <h3 class="visual-title">How Earned Income is Taxed</h3>
                    <div class="tax-flow-diagram">
                        <div class="flow-step">
                            <div class="flow-icon">ðŸ’¼</div>
                            <div class="flow-label">You Work</div>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">
                            <div class="flow-icon">ðŸ’µ</div>
                            <div class="flow-label">Earn Wages</div>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">
                            <div class="flow-icon">ðŸ“Š</div>
                            <div class="flow-label">Ordinary Tax Rates</div>
                        </div>
                        <div class="flow-arrow">â†’</div>
                        <div class="flow-step">
                            <div class="flow-icon">ðŸ“‹</div>
                            <div class="flow-label">Payroll Taxes Too</div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="#fbbf24" stroke-width="2"/>
                            <path d="M12 8 L12 12 L12 16" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="12" cy="6" r="1" fill="#fbbf24"/>
                        </svg>
                    </div>
                    <div class="info-content">
                        <h3 class="info-title">Important Note</h3>
                        <p>Earned income is also subject to <strong>payroll taxes</strong> (Social Security and Medicare), which add an additional 7.65% for employees and 15.3% for self-employed individuals.</p>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-secondary" disabled>Previous</button>
                    <button class="btn-primary next-btn" onclick="goToSection(2)">Next Section</button>
                </div>
            </section>

            <!-- Section 2: Passive Income -->
            <section class="lesson-section" id="section-2">
                <div class="section-number">Section 2 of 5</div>
                <h2 class="section-title">Passive Income</h2>

                <div class="content-block">
                    <p class="content-text">
                        <strong>Passive income</strong> is money earned from investments or activities where you're not actively involved. This includes rental properties, dividends, and interest.
                    </p>
                    <p class="content-text">
                        The tax treatment of passive income varies depending on the specific type.
                    </p>
                </div>

                <div class="impact-cards">
                    <div class="impact-card">
                        <div class="impact-number">1</div>
                        <h3 class="impact-title">Interest Income</h3>
                        <p class="impact-description">
                            Interest from savings accounts, bonds, and CDs is taxed as ordinary income at your regular tax bracket rates.
                        </p>
                        <div class="example-box">
                            <strong>Example:</strong><br>
                            Earn $500 in interest from a high-yield savings account â†’ Taxed at your ordinary income rate (10-37%)
                        </div>
                    </div>

                    <div class="impact-card">
                        <div class="impact-number">2</div>
                        <h3 class="impact-title">Dividend Income</h3>
                        <p class="impact-description">
                            Qualified dividends are taxed at preferential capital gains rates (0%, 15%, or 20%), while ordinary dividends are taxed as regular income.
                        </p>
                        <div class="example-box">
                            <strong>Tax Rate:</strong><br>
                            Qualified dividends: 0-20%<br>
                            Ordinary dividends: 10-37%
                        </div>
                    </div>

                    <div class="impact-card">
                        <div class="impact-number">3</div>
                        <h3 class="impact-title">Rental Income</h3>
                        <p class="impact-description">
                            Net rental income (after expenses) is taxed as ordinary income, but you can deduct depreciation, repairs, and other expenses.
                        </p>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-secondary prev-btn" onclick="goToSection(1)">Previous</button>
                    <button class="btn-primary next-btn" onclick="goToSection(3)">Next Section</button>
                </div>
            </section>

            <!-- Section 3: Capital Gains -->
            <section class="lesson-section" id="section-3">
                <div class="section-number">Section 3 of 5</div>
                <h2 class="section-title">Capital Gains Income</h2>

                <div class="content-block">
                    <p class="content-text">
                        <strong>Capital gains</strong> occur when you sell an asset (like stocks, real estate, or cryptocurrency) for more than you paid for it. The profit is taxable.
                    </p>
                    <p class="content-text">
                        Capital gains are taxed differently depending on how long you held the asset.
                    </p>
                </div>

                <div class="visual-card">
                    <h3 class="visual-title">Short-Term vs. Long-Term Capital Gains</h3>
                    <div class="comparison-chart">
                        <div class="comparison-item">
                            <div class="comparison-label"><strong>Short-Term</strong> (Held â‰¤ 1 year)</div>
                            <div class="comparison-bar" style="background: #e74c3c; width: 80%;">
                                <span class="comparison-value">10% - 37%</span>
                            </div>
                            <p style="margin-top: 0.5rem; font-size: 0.9rem;">Taxed at ordinary income rates</p>
                        </div>
                        <div class="comparison-item">
                            <div class="comparison-label"><strong>Long-Term</strong> (Held > 1 year)</div>
                            <div class="comparison-bar" style="background: #2ed573; width: 40%;">
                                <span class="comparison-value">0% - 20%</span>
                            </div>
                            <p style="margin-top: 0.5rem; font-size: 0.9rem;">Preferential lower rates</p>
                        </div>
                    </div>
                </div>

                <div class="summary-card">
                    <h3>ðŸ“Š Long-Term Capital Gains Rates (2024)</h3>
                    <ul class="summary-list">
                        <li><strong>0% Rate:</strong> Income up to $44,625 (single) / $89,250 (married)</li>
                        <li><strong>15% Rate:</strong> Income $44,626 - $492,300 (single) / $89,251 - $553,850 (married)</li>
                        <li><strong>20% Rate:</strong> Income above $492,300 (single) / $553,850 (married)</li>
                    </ul>
                </div>

                <div class="info-box">
                    <div class="info-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="12" cy="12" r="10" stroke="#fbbf24" stroke-width="2"/>
                            <path d="M12 8 L12 12 L12 16" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                            <circle cx="12" cy="6" r="1" fill="#fbbf24"/>
                        </svg>
                    </div>
                    <div class="info-content">
                        <h3 class="info-title">Strategy Tip</h3>
                        <p>Holding investments for more than one year can significantly reduce your tax bill. A $10,000 gain could save you $1,700+ in taxes!</p>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-secondary prev-btn" onclick="goToSection(2)">Previous</button>
                    <button class="btn-primary next-btn" onclick="goToSection(4)">Next Section</button>
                </div>
            </section>

            <!-- Section 4: Knowledge Check Quiz -->
            <section class="lesson-section" id="section-4">
                <div class="section-number">Section 4 of 5</div>
                <h2 class="section-title">Knowledge Check</h2>

                <div class="content-block">
                    <p class="content-text">
                        Test your understanding of different income types and their tax treatment.
                    </p>
                </div>

                <div class="quiz-container">
                    <!-- Question 1 -->
                    <div class="quiz-question" id="quiz-1">
                        <div class="question-header">
                            <span class="question-number">Question 1 of 3</span>
                        </div>
                        <h3 class="question-text">Which type of income is subject to both income tax AND payroll taxes?</h3>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(1, 'A', true)">
                                <input type="radio" name="q1" id="q1-a">
                                <label for="q1-a">A) Earned income (wages and salaries)</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(1, 'B', false)">
                                <input type="radio" name="q1" id="q1-b">
                                <label for="q1-b">B) Capital gains</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(1, 'C', false)">
                                <input type="radio" name="q1" id="q1-c">
                                <label for="q1-c">C) Dividend income</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(1, 'D', false)">
                                <input type="radio" name="q1" id="q1-d">
                                <label for="q1-d">D) Interest income</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback-1"></div>
                    </div>

                    <!-- Question 2 -->
                    <div class="quiz-question" id="quiz-2" style="display: none;">
                        <div class="question-header">
                            <span class="question-number">Question 2 of 3</span>
                        </div>
                        <h3 class="question-text">You bought stock for $5,000 and sold it 18 months later for $8,000. How is your $3,000 profit taxed?</h3>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(2, 'A', false)">
                                <input type="radio" name="q2" id="q2-a">
                                <label for="q2-a">A) As ordinary income at 10-37%</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(2, 'B', true)">
                                <input type="radio" name="q2" id="q2-b">
                                <label for="q2-b">B) As long-term capital gains at 0-20%</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(2, 'C', false)">
                                <input type="radio" name="q2" id="q2-c">
                                <label for="q2-c">C) As short-term capital gains at ordinary rates</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(2, 'D', false)">
                                <input type="radio" name="q2" id="q2-d">
                                <label for="q2-d">D) It's not taxed because it's an investment</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback-2"></div>
                    </div>

                    <!-- Question 3 -->
                    <div class="quiz-question" id="quiz-3" style="display: none;">
                        <div class="question-header">
                            <span class="question-number">Question 3 of 3</span>
                        </div>
                        <h3 class="question-text">What is the main advantage of qualified dividend income?</h3>
                        <div class="quiz-options">
                            <div class="quiz-option" onclick="selectAnswer(3, 'A', false)">
                                <input type="radio" name="q3" id="q3-a">
                                <label for="q3-a">A) It's completely tax-free</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(3, 'B', true)">
                                <input type="radio" name="q3" id="q3-b">
                                <label for="q3-b">B) It's taxed at lower capital gains rates instead of ordinary income rates</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(3, 'C', false)">
                                <input type="radio" name="q3" id="q3-c">
                                <label for="q3-c">C) You don't have to report it on your tax return</label>
                            </div>
                            <div class="quiz-option" onclick="selectAnswer(3, 'D', false)">
                                <input type="radio" name="q3" id="q3-d">
                                <label for="q3-d">D) It's only taxed if you reinvest it</label>
                            </div>
                        </div>
                        <div class="quiz-feedback" id="feedback-3"></div>
                    </div>

                    <div class="quiz-results" id="quiz-results" style="display: none;">
                        <h3>Quiz Complete! ðŸŽ‰</h3>
                        <p class="quiz-score">You got <span id="quiz-score">0</span> out of 3 correct!</p>
                        <p class="quiz-message" id="quiz-message"></p>
                    </div>
                </div>

                <div class="navigation-buttons">
                    <button class="btn-secondary prev-btn" onclick="goToSection(3)">Previous</button>
                    <button class="btn-primary next-btn" id="quiz-next-btn" onclick="goToSection(5)" disabled>Next Section</button>
                </div>
            </section>

            <!-- Section 5: Summary & Next Steps -->
            <section class="lesson-section" id="section-5">
                <div class="section-number">Section 5 of 5</div>
                <h2 class="section-title">Lesson Summary</h2>

                <div class="summary-card">
                    <h3>ðŸŽ¯ What You Learned Today</h3>
                    <ul class="summary-list">
                        <li><strong>Earned income</strong> from work is taxed at ordinary rates plus payroll taxes</li>
                        <li><strong>Passive income</strong> includes interest, dividends, and rental income with varying tax treatment</li>
                        <li><strong>Capital gains</strong> are taxed based on how long you held the asset</li>
                        <li><strong>Long-term capital gains</strong> (held > 1 year) get preferential lower tax rates</li>
                        <li><strong>Different income types</strong> require different tax planning strategies</li>
                    </ul>
                </div>

                <div class="next-lesson-preview">
                    <h3>ðŸ“š Coming Up Next: Standard vs. Itemized Deductions</h3>
                    <p>In the next lesson, you'll learn how deductions reduce your taxable income and when to itemize versus taking the standard deduction.</p>
                    <div class="preview-topics">
                        <span class="preview-tag">Standard Deduction</span>
                        <span class="preview-tag">Itemized Deductions</span>
                        <span class="preview-tag">Tax Savings</span>
                    </div>
                </div>

                <div class="completion-actions">
                    <button class="btn-secondary prev-btn" onclick="goToSection(4)">Previous</button>
                    <button class="btn-primary complete-btn" onclick="completeLesson()">Complete Lesson</button>
                </div>
            </section>
        </div>
    </main>

    <script>
        let currentSection = 1;
        let quizScore = 0;
        let quizAnswered = [false, false, false];
        let currentQuizQuestion = 1;

        // Update progress bar
        function updateProgress() {
            const progress = (currentSection / 5) * 100;
            document.getElementById('lesson-progress-fill').style.width = progress + '%';
            document.getElementById('current-section').textContent = currentSection;
        }

        // Navigate between sections
        function goToSection(sectionNum) {
            // Hide current section
            document.getElementById(`section-${currentSection}`).classList.remove('active');

            // Show new section
            currentSection = sectionNum;
            document.getElementById(`section-${currentSection}`).classList.add('active');

            // Update progress
            updateProgress();

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Quiz functionality
        function selectAnswer(questionNum, answer, isCorrect) {
            const feedback = document.getElementById(`feedback-${questionNum}`);
            const option = event.currentTarget;

            // Disable all options for this question
            const allOptions = option.parentElement.querySelectorAll('.quiz-option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
                opt.classList.add('disabled');
            });

            // Mark selected option
            option.classList.add(isCorrect ? 'correct' : 'incorrect');

            if (isCorrect) {
                if (!quizAnswered[questionNum - 1]) {
                    quizScore++;
                    quizAnswered[questionNum - 1] = true;
                }
                feedback.innerHTML = `
                    <div class="feedback-correct">
                        <span class="feedback-icon">âœ“</span>
                        <span>Correct! Great job!</span>
                    </div>
                `;
            } else {
                quizAnswered[questionNum - 1] = true;
                feedback.innerHTML = `
                    <div class="feedback-incorrect">
                        <span class="feedback-icon">âœ—</span>
                        <span>Not quite. Review the material and try again!</span>
                    </div>
                `;
            }

            feedback.style.display = 'block';

            // Show next question or results
            setTimeout(() => {
                if (questionNum < 3) {
                    document.getElementById(`quiz-${questionNum}`).style.display = 'none';
                    document.getElementById(`quiz-${questionNum + 1}`).style.display = 'block';
                    currentQuizQuestion++;
                } else {
                    // Show results
                    showQuizResults();
                }
            }, 1500);
        }

        function showQuizResults() {
            document.getElementById('quiz-3').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'block';
            document.getElementById('quiz-score').textContent = quizScore;

            const messageEl = document.getElementById('quiz-message');
            if (quizScore === 3) {
                messageEl.innerHTML = 'ðŸŒŸ Perfect score! You understand income types well!';
            } else if (quizScore === 2) {
                messageEl.innerHTML = 'ðŸ‘ Good job! You\'re getting the hang of it.';
            } else {
                messageEl.innerHTML = 'ðŸ“– Keep learning! Review the material and you\'ll get it.';
            }

            // Enable next button
            document.getElementById('quiz-next-btn').disabled = false;
        }

        // Complete lesson
        async function completeLesson() {
            try {
                // Mark lesson as complete in backend
                await api.completeLesson('tax-fundamentals', 1, 3, quizScore);

                // Show success message
                alert('ðŸŽ‰ Congratulations! You\'ve completed Lesson 3. Keep up the great work!');

                // Redirect back to unit page
                window.location.href = 'unit.html?course=tax-fundamentals';
            } catch (error) {
                console.error('Failed to mark lesson complete:', error);
                // Still redirect even if API fails
                window.location.href = 'unit.html?course=tax-fundamentals';
            }
        }

        // Logout functionality
        document.getElementById('logout-btn').addEventListener('click', (e) => {
            e.preventDefault();
            if (confirm('Are you sure you want to logout?')) {
                api.logout();
            }
        });

        // Initialize
        updateProgress();
    </script>
</body>
</html>
